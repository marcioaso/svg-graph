<html>
<head>
    <style>
        body {
            background:#f0f0f0;
        }
        #graphic {
            display: block;
            width: 400px;
            height: 150px;
        }
        path {
            fill: transparent;
            stroke-width:2px;
            stroke-linejoin:square;
            stroke-linecap:butt;
        }
    </style>
    <script>
        DEV = true;
        function log() {
            try {
                if(DEV) console.log.apply(null,arguments);
            } catch(e) {

            }
        }
        //const data = [38.28,67.87,22.21,6.3,75.7,18.14,52.18,59.13,3.96,14.01,28.44,68.7,66.89,72.45,34.49,44.08,44.91,30.54,87.58,59.09,74.48,32.58,46.96,78.51,36.63,89.09,73.72,37.93,34.18,67.62,75.06,9.2,94.62,45.88,47.72,0.55,85.6,71.77,31.7,1.95,72.67,12.35,82.36,54.53,21.72,61.56,71.5,9.31,50.3,57.99,24.61,40.57,92.35,73.04,49.66,94.89,65.48,81.6,91.17,94.98,86.47,13.87,24.03,82.13,81.66,15.88,72.39,73.27,53.12,25.67,43.96,94.9,88.94,71.81,86.13,81.5,10.18,70.25,26.55,19.29,31.16,52.45,98.05,16.25,20.56,6.3,44.45,25.12,99.74,44.57,32.63,50.59,75.25,10.53,46.29,83.14,1.89,61.41,75.74,58.77,4.72,58.34,22.41,85.37,32.47,1.77,6.65,70.46,71.79,19.94,73.15,79.38,54.01,19.26,93.74,37.89,37.74,2.88,76.46,35,31.67,33.56,18.73,95.28,59.78,50.11,80.25,46.74,64.57,71.75,79.24,10.27,23.7,33.22,33.22,93.08,22.27,48.51,63.16,21.41,57.06,65.34,91.52,94.33,61.74,67.12,73.51,72.66,62.76,35.48,41.53,2.39,97.61,72.89,52.36,38.31,25.73,82.01,7.87,11.78,65.22,78.53,57.79,18.16,29.17,55.49,66.42,82.59,42.21,99.26,14.73,55.57,69.01,55.58,83.31,90.79,11.34,73.89,78.87,29,1.36,96.23,73.65,71.38,15.4,89.48,97.95,93.57,75.45,46.45,12.43,2.6,79.45,30.85,61.26,21.47,70.9,78.25,82.17,87.82,89.8,92.79,75.57,50.14,14.59,68.83,23.86,29.2,71.44,11.27,76.23,74.87,42.61,40.63,16.91,65.9,74.02,35.95,59.03,8.94,19.65,66.86,4.56,81.39,47.08,50.81,28.23,65.98,86.55,57.19,19.57,78.65,94.44,23.01,79.24,4.53,46.42,50.46,43.98,66.46,62.44,15.64,89.02,0.07,95.3,81.36,3.82,78.58,27.17,78.98,37.39,95.6,88.07,42.46,64.15,61.91,81.66,30.72,64.42,14.01,31.1,95.7,78.98,0.13,69.57,7.56,4.98,58.69,73.44,35.63,8.89,26.52,84.26,97.19,89.08,13.82,50.08,72.82,25.54,92.67,9.03,89.94,99.71,28.55,43.36,20.13,69,61.7,34.74,5.67,12.23,14.05,82.43,34.56,67.76,9.29,1.59,47.32,16.46,0.5,34.94,74.37,31.19,26.26,1.81,10.21,13.35,26.76,83.43,32.91,42.5,3.56,79.74,53.44,50.8,37.71,72.23,3.15,77.35,8.74,54.54,44.51,50.04,19.89,62.91,85.38,34.45,79.48,82.47,41.82,96.6,35.54,32.05,72.9,92.68,7.09,23.2,18.12,14.68,32.22,88.39,75.96,64.18,77.46,62.92,23.21,98.7,54.12,76.72,90.06,26.3,83.38,47.48,88.39,36.79,89.93,42.91,84.35,80.16,52.76,66.93,76.75,49.74,16.86,78.97,88.94,7.24,75.9,28.02,31.54,54.81,66.48,63.77,45.64,29.9,53.16,62.88,39.14,44.53,49.26,79.01,76.55,34.43,6.77,12.77,49.97,95.22,66.1,97.75,31.31,22.31,92.16,52.11,52.93,22.01,34.53,11.45,30.29,29.86,69.39,97.89,77.35,60.36,38.55,89.56,22.01,1.38,8.41,50.68,74.68,56.41,58.12,67.45,8.45,66.25,77.96,97.98,68.37,66.74,72.05,20.33,25.58,33.84,1.31,60.76,72.35,7.97,45.34,58.59,34.59,27.96,55.01,59.69,23.13,21.58,95.09,62.11,95.97,91.17,1.29,72.95,29.77,85.71,33.9,94.83,68.64,44.62,19.76,32.38,37.03,96.88,16.72,52.82,71.96,18.72,6.5,58.13,18.91,86.31,74.64,90.63,18.78,21.41,3,14.81,89.58,67.09,58.4,32.6,41.17,63.76,65.55,44.93,8.85,8.85,44.41,88.07,54.15,72.35,8.44,55.31,66.43,51.56,4.68,13.65,46.5,41.77,21.43,19.51,57.54,37.51,81.43,27.24,18.64,2.83,2.17,69.86,9.16,10.04,51.57,61.54,5.84,63.06,28.84,78.59,55.2,71.19,59.43,92.06,75.81,32.62,42.59,53.03,36.83,39.67,70.56,84.96,65.96,92.74,48.13,67.09,25.7,14.15,91.74,62.58,90.79,6.92,55.21,50.72,99.25,5.3,75.71,44.51,18.74,72.64,22.04,24.24,63.07,83.13,3.99,17.23,65.17,54.29,29.52,71.56,76.55,37.76,6.49,17.07,62.34,29.29,65.54,99.76,36.81,28.68,64.11,9.02,86.86,39.27,81.78,4.95,81.13,78.49,49.82,63.04,85.41,60.53,13.38,81.66,80.98,90.02,45.4,70.98,18.49,34.82,83.01,5.81,43.98,79.47,82.39,6.84,4.84,55.15,24.57,92.03,55,81.83,79.22,11.01,84.17,31.52,45.8,9.66,25.35,44.67,88.2,39.37,67.78,85.49,24.27,28.4,39.87,1.64,53.59,30.96,62.94,87.2,66.71,56.96,40.04,47.7,96.44,55.46,15.91,53.42,30.14,84.38,89.2,72.1,65.15,0.54,21.6,9.74,28.77,96.63,1.19,12.84,41.08,57.21,26.28,44.45,2.16,57.63,15.34,50.23,82.82,41.55,61.84,24.7,22.44,41.44,94.54,30.8,37.01,99.87,92.18,41.84,61.33,69.28,92.85,7.03,37.06,38.06,34.98,74.19,19.75,26.61,65.84,42.22,39.1,21.72,67.04,41.51,80.78,67.43,22.06,5.85,30.04,12.13,20.09,72.13,8.36,30.67,6.25,76.08,76.01,53.32,46.95,80.35,81.66,44.89,72.95,93.35,86.31,83.69,94.67,93.96,81.12,29.06,61.78,9.65,62.94,77.21,56.46,68.74,55.83,49.44,17.78,71.97,14.56,36.8,54.95,66.3,58.88,95.32,18.01,4.66,79.43,82.63,73.48,2.01,59.31,91.06,54.84,85.11,8.39,3.24,12.67,17.01,57.75,93.71,52.82,0.16,3.69,76.09,91.11,48.47,18.48,82.51,18.73,98.17,54.18,9.95,57.3,70.55,48.7,7.73,98.17,60.56,84.8,39.72,70.19,58.95,57.75,97.73,8.61,24.49,84.02,24.41,55.23,54.72,57.08,13.29,4.8,75.53,47.43,58.83,97.47,98.21,49.72,77.52,95.43,62.21,68.78,15.34,21.21,63.26,52.35,2.89,37.11,94.96,30.17,90.83,24.37,74.34,48.68,11.57,1.37,25.82,70.13,96.43,65.54,23.53,68.41,33.01,72.68,22.83,69.03,88.37,54.77,0.26,16.41,12.17,8.15,20.28,51.38,64.55,79.07,9.22,54.52,18.85,3.14,59.16,20.07,88.28,3.6,39.8,96.29,57,15.28,86.79,53.24,35.97,75.99,75.39,14.25,63.57,73.68,92.96,82.59,42.86,21.38,38.24,48.5,67.22,87.4,81.38,72.8,96.02,51.92,96.13,76.27,36.68,50.86,51.14,45.37,91.33,50.32,91.55,70.69,50.16,17.05,35.53,80.38,33.37,13.79,69.6,9.94,1.19,56.52,8.64,73.61,46.18,88.58,78.59,37.51,5,75.6,10.21,40.6,19.98,15.96,31.79,75.95,28.1,97.61,36.49,71.7,98.53,14.86,72.8,17.59,21.64,24.18,86.95,50.17,85.14,43.73,17.07,88.59,76.76,24.58,49.46,17.4,13.31,5.43,54.42,67.42,41.57,38.8,94.48,40.22,65.26,97.79,84.08,97.56,6.25,20.98,59,89.38,21.51,85.32,24.24,94.71,21.8,13.64,91.35,50.59,84.18,81.18,84.07,4.89,0.64,19.9,97.07,40.49,44.24,77.92,14.75,46.42,11.5,86.47,70.62,51.44,14.46,10.31,61.33,41.6,90.74,30.93,54.87,32.38,11.64,35.4,98.12,5.45,77.96,35.4,83.86,71.38,91.03,91.97,81.48,63.05,3.65,98.96,5.85,3.92,42.14,37.1,55.34,36.47,94.23,86.6,28.51,83.24,40.54,46.86,72.17,23.87,72.14,27.15,33.17,11.19,87.91,31.87,48.6,87.96,27.43,65.78,62.73,82.28,13.07,62.18,65.47,65.42,96.21,26.21,91.28,59.09,48.53,25.4,49.59,93.4,4.07,63.27,29.35,61.19,33.78,85.49,76.93,40.31,77.7,5.04,80.9,59.95,1.54,56.62,15.98,21.14];
        let data = [];
        let min = 7151;
        const getRand = () => Math.round(Math.random()*10000)/100;
        let timestamp = new Date().getTime();
        const qtd = 2000;
        for(var i=0;i<qtd;i++) {
            let value = min + getRand();
            if(i % 13 == 0) value += i/100;
            data.push({
                value,
                time: timestamp - ((qtd-i)*60000)
            });
        }
    </script>
</head>
<body>
    <div id="graphic"></div>
    
    <script>
        const generateSVGLineChart = conf => {
            console.time("teste")
            let {data,paddingHorizontal,marginTop,width,height,dataProps:props} = conf;

            // required
            if(!data || !data.length) throw new Error("you should pass an array as data");
            if(!width || !height) throw new Error("width and height should be passed");

            // optionals
            paddingHorizontal = paddingHorizontal || 0;
            marginTop = marginTop || 0;

            let decimate = 1/3, xProg = 3+decimate; // prog corrects the x axis

            const widthPadded = width - paddingHorizontal;
            const widthDoublePadded = widthPadded - paddingHorizontal;

            let max = 0, min = Infinity, values = [];
            
            // if the length of the data putted on the graphic width space would lead to more than 3 points in 10 px
            if((data.length/widthPadded) > decimate) { 
                let numberOfPoints = parseInt((widthDoublePadded) / 10 * 3);
                const leverage = parseInt(data.length / numberOfPoints);
                let dataLast = data[data.length-1][props.value], last=null;
                for(var i=0;i<numberOfPoints;i++) {
                    const cursor = data[i*leverage][props.value];
                    if(min > cursor) min = cursor;
                    if(max < cursor) max = cursor;
                }
                for(var i=0;i<numberOfPoints;i++) {
                    const cursor = data[i*leverage][props.value]-min;
                    last = cursor;
                    values.push(cursor);
                };
            } else {
                xProg = (widthDoublePadded) / (data.length-1);
                for(var i=0;i<data.length;i++) {
                    const cursor = data[i][props.value];
                    if(min > cursor) min = cursor;
                    if(max < cursor) max = cursor;
                }
                for(var i=0;i<data.length;i++) {
                    const cursor = data[i][props.value]-min;
                    values.push(cursor);
                }
            }
            const yProportion = (height-(marginTop*2))/(max-min); // proportion corrects the y axis

            let lastX = 0, polygonStarter = `${paddingHorizontal},${height}`, path = [];

            // building the gradient polygon
            let polygon = [polygonStarter]
                .concat(values.map(
                    (each,i) => {
                        const yInvert = (height - (each*yProportion)-marginTop);
                        lastX = (i*xProg)+paddingHorizontal;
                        let ret = `${lastX},${yInvert}`;

                        // building the path svg tag
                        switch(i) {
                            case 0:
                                path.push(`M${ret} L`);
                            break;
                            case 1:
                                path[0] += ret;
                            break;
                            default:
                                path.push(ret)
                        }
                        return ret;
                    })
                )
            polygon.push(`${lastX},${height}`);
            
            // both should be strings with points separated by spaces
            polygon = polygon.join(" "); 
            path = path.join(" ");

            // if the chart ends with a number higher than started, it's green.
            let colorSchemeName = values[0] < values[values.length-1]?"green":"red";
            let colorScheme = conf.colors[colorSchemeName];
            console.timeEnd("teste")
            return `
                <svg width="${width}" height="${height}" style="fill:white">
                    <rect x="0" width="${width}" y="0" height="${height}" style="fill:white"/>
                    <g>
                        <path d="${path}" style="stroke:${colorScheme.stroke}"/>
                        <polygon points="${polygon}" style="fill:url(#grad-${colorSchemeName})" />
                    </g>
                    <defs>
                        <linearGradient id="grad-green" x2="0" y2="1">
                            <stop offset="0" stop-color="${conf.colors.green.gradient}"/>
                            <stop offset="1" stop-color="white"/>
                        </linearGradient>
                        <linearGradient id="grad-red" x2="0" y2="1">
                            <stop offset="0" stop-color="${conf.colors.red.gradient}"/>
                            <stop offset="1" stop-color="white"/>
                        </linearGradient>
                    </defs>
            </svg>`;
        }

        document.querySelector("#graphic").innerHTML = generateSVGLineChart({
            data,
            width: 350,
            height: 200,
            dataProps: {
                value: "value",
                timeStamp: "time"
            },
            colors:{
                green:{
                    gradient:"#a7ff96",
                    stroke:"#008e00"
                },
                red:{
                    gradient:"#ff9696",
                    stroke:"#8e0000"
                }
            },
            paddingHorizontal: 5, // optional
            marginTop: 30 // optional
        })

    </script>
</body>
</html>